<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.75.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=keywords content="k8s,lesson"><meta name=description content><meta property="og:title" content="Lessons Learned for Reading K8s Source Code"><meta property="og:description" content="Package  sigs.k8s.io/controller-runtime/pkg/manager  Lessons Use stop channel to stop things  stop engageStopProcedure stopComplete internalStop internalStopper(write side of the internal stop channel) onStoppedLeading gracefulShutdownTimeout shutdownCtx stopErr may happen errChan to signal error support graceful shutdown(leader lost stop immediately) use context to cancel things   how to view this flow visually, a slow test scenery to visualize it?
 Use mutex to protect receiver changes  protect write or read for receiver(about 80% methods)  Use interface to inject dependencies  Runnable type  Use New with config and options  option provide default config provide rest client mostly(init by user) internal struct hidden from user, use extra method to expose field access."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.clwen.com/posts/lessons-learned-for-reading-k8s-source-code/"><meta property="article:published_time" content="2020-09-22T22:37:12+08:00"><meta property="article:modified_time" content="2020-09-22T22:37:12+08:00"><meta property="og:see_also" content="https://blog.clwen.com/posts/kubeadm-expire-change/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lessons Learned for Reading K8s Source Code"><meta name=twitter:description content="Package  sigs.k8s.io/controller-runtime/pkg/manager  Lessons Use stop channel to stop things  stop engageStopProcedure stopComplete internalStop internalStopper(write side of the internal stop channel) onStoppedLeading gracefulShutdownTimeout shutdownCtx stopErr may happen errChan to signal error support graceful shutdown(leader lost stop immediately) use context to cancel things   how to view this flow visually, a slow test scenery to visualize it?
 Use mutex to protect receiver changes  protect write or read for receiver(about 80% methods)  Use interface to inject dependencies  Runnable type  Use New with config and options  option provide default config provide rest client mostly(init by user) internal struct hidden from user, use extra method to expose field access."><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><title>Lessons Learned for Reading K8s Source Code | Chinglin</title></head><body><header><div id=titletext><h2 id=title><a href=https://blog.clwen.com/>Chinglin</a></h2></div><div id=title-description><p id=subtitle>Take tremendous effort to be lazy !</p><div id=social><nav><ul><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/about>About</a></li></ul></nav></div></header><main><div class=post><div class=author></div><div class=post-header><div class=meta><div class=date><span class=day>22</span>
<span class=rest>Sep 2020</span></div></div><div class=matter><h1 class=title>Lessons Learned for Reading K8s Source Code</h1></div></div><div class=markdown><h2 id=package>Package</h2><ul><li>sigs.k8s.io/controller-runtime/pkg/manager</li></ul><h2 id=lessons>Lessons</h2><h3 id=use-stop-channel-to-stop-things>Use stop channel to stop things</h3><ul><li>stop</li><li>engageStopProcedure</li><li>stopComplete</li><li>internalStop</li><li>internalStopper(write side of the internal stop channel)</li><li>onStoppedLeading</li><li>gracefulShutdownTimeout</li><li>shutdownCtx</li><li>stopErr may happen</li><li>errChan to signal error</li><li>support graceful shutdown(leader lost stop immediately)</li><li>use context to cancel things</li></ul><blockquote><p>how to view this flow visually, a slow test scenery to visualize it?</p></blockquote><h3 id=use-mutex-to-protect-receiver-changes>Use mutex to protect receiver changes</h3><ul><li>protect write or read for receiver(about 80% methods)</li></ul><h3 id=use-interface-to-inject-dependencies>Use interface to inject dependencies</h3><ul><li>Runnable type</li></ul><h3 id=use-new-with-config-and-options>Use New with config and options</h3><ul><li>option provide default</li><li>config provide rest client mostly(init by user)</li><li>internal struct hidden from user, use extra method to expose field access.</li><li>provide set default options, make default useful.</li></ul><h3 id=separate-package-to-small-scope-maximize-reusability>Separate package to small scope, maximize reusability</h3></div><div class=tags><div class=taxosfloating_left><p>Authors</p></div><div class=termsfloating_right><p><a href=/authors/wen/>wen</a></p></div><div class=clearit></div><div class=tags><div class=taxosfloating_left><p>Series</p></div><div class=termsfloating_right><p><a href=/series/code/>code</a></p></div><div class=clearit></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/k8s/>k8s</a>
<a href=/tags/lesson/>lesson</a></p></div><div class=clearit></div></div><script src=https://utteranc.es/client.js repo=chinglinwen/blog issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></main><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-64589695-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>